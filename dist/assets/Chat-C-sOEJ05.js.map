{"version":3,"file":"Chat-C-sOEJ05.js","sources":["../../src/hooks/useApi.js","../../src/hooks/useChat.js","../../src/components/Chat.jsx"],"sourcesContent":["import { useState, useEffect, useCallback } from 'react';\n\nexport function useApi() {\n  const [config, setConfig] = useState(null);\n  const [loading, setLoading] = useState(true);\n  const [error, setError] = useState(null);\n\n  // Fetch client configuration\n  const fetchConfig = useCallback(async () => {\n    try {\n      setLoading(true);\n      setError(null);\n\n      // Check if we're in development or test mode\n      const isDevelopment =\n        import.meta.env.DEV ||\n        import.meta.env.MODE === 'development' ||\n        import.meta.env.MODE === 'test' ||\n        window.location.hostname === 'localhost' ||\n        window.location.hostname.includes('localhost');\n\n      console.log('Environment check:', {\n        DEV: import.meta.env.DEV,\n        MODE: import.meta.env.MODE,\n        hostname: window.location.hostname,\n        isDevelopment,\n      });\n\n      if (isDevelopment) {\n        // Use mock configuration for development and testing\n        console.log('Development mode: Using mock configuration');\n        setConfig({\n          authSecret: 'dev-mock-secret-key-123',\n          environment: 'development',\n          apiBase: '/api',\n          features: {\n            chat: true,\n            diagnostics: true,\n            recording: false,\n          },\n          rateLimits: {\n            roomCreation: 50,\n            chatMessages: 60,\n            apiCalls: 2000,\n          },\n        });\n        setLoading(false);\n        return;\n      }\n\n      const response = await fetch('/api/config');\n\n      if (!response.ok) {\n        throw new Error(`Failed to fetch config: ${response.status}`);\n      }\n\n      const data = await response.json();\n\n      if (data.success && data.config) {\n        console.log('Setting config:', data.config);\n        setConfig(data.config);\n      } else {\n        throw new Error('Invalid config response format');\n      }\n    } catch (err) {\n      console.error('Failed to fetch client configuration:', err);\n      setError(err.message);\n      setConfig(null);\n    } finally {\n      setLoading(false);\n    }\n  }, []);\n\n  // Fetch config on mount\n  useEffect(() => {\n    fetchConfig();\n  }, [fetchConfig]);\n\n  // Create room\n  const createRoom = useCallback(async () => {\n    try {\n      // Check if we're in development or test mode\n      const isDevelopment =\n        import.meta.env.DEV ||\n        import.meta.env.MODE === 'development' ||\n        import.meta.env.MODE === 'test' ||\n        window.location.hostname === 'localhost' ||\n        window.location.hostname.includes('localhost');\n\n      if (isDevelopment) {\n        // Mock room creation for development and testing\n        console.log('Development mode: Mock room creation');\n        return {\n          success: true,\n          roomId: 'dev-mock-room-' + Math.random().toString(36).substr(2, 9),\n          message: 'Mock room created successfully',\n        };\n      }\n\n      console.log('Creating room with config:', config);\n      const headers = {\n        'Content-Type': 'application/json',\n        ...(config?.authSecret && { 'x-auth-secret': config.authSecret }),\n      };\n      console.log('Request headers:', headers);\n\n      const response = await fetch('/api/create-room', {\n        method: 'POST',\n        headers,\n      });\n\n      if (!response.ok) {\n        let errorText = '';\n        try {\n          errorText = await response.text();\n        } catch (e) {\n          errorText = 'Unable to read error response';\n        }\n        console.error('Room creation failed:', {\n          status: response.status,\n          statusText: response.statusText,\n          body: errorText,\n          headers: response.headers ? Object.fromEntries(response.headers.entries()) : 'No headers',\n        });\n        throw new Error(\n          `Failed to create room: ${response.status} ${response.statusText}${errorText ? ` - ${errorText}` : ''}`\n        );\n      }\n\n      const data = await response.json();\n      return data;\n    } catch (err) {\n      console.error('Error creating room:', err);\n      throw err;\n    }\n  }, [config]);\n\n  // Send chat message\n  const sendChatMessage = useCallback(\n    async (roomId, message, sender, secret = null) => {\n      try {\n        // Check if we're in development or test mode\n        const isDevelopment =\n          import.meta.env.DEV ||\n          import.meta.env.MODE === 'development' ||\n          import.meta.env.MODE === 'test' ||\n          window.location.hostname === 'localhost' ||\n          window.location.hostname.includes('localhost');\n\n        if (isDevelopment) {\n          // Return mock response for development and testing\n          return {\n            ok: true,\n            message: {\n              id: Date.now().toString(),\n              roomId,\n              sender,\n              message,\n              timestamp: Date.now(),\n            },\n          };\n        }\n\n        const response = await fetch('/api/chat', {\n          method: 'POST',\n          headers: {\n            'Content-Type': 'application/json',\n            ...(config?.authSecret && { 'x-auth-secret': config.authSecret }),\n          },\n          body: JSON.stringify({\n            roomId,\n            message,\n            sender,\n            ...(secret && { secret }),\n          }),\n        });\n\n        if (!response.ok) {\n          throw new Error(`Failed to send message: ${response.status}`);\n        }\n\n        const data = await response.json();\n        return data;\n      } catch (err) {\n        console.error('Error sending chat message:', err);\n        throw err;\n      }\n    },\n    [config]\n  );\n\n  // Get chat messages\n  const getChatMessages = useCallback(async (roomId, since = 0) => {\n    try {\n      // Check if we're in development or test mode\n      const isDevelopment =\n        import.meta.env.DEV ||\n        import.meta.env.MODE === 'development' ||\n        import.meta.env.MODE === 'test' ||\n        window.location.hostname === 'localhost' ||\n        window.location.hostname.includes('localhost');\n\n      if (isDevelopment) {\n        // Return mock response for development and testing\n        return {\n          messages: [],\n          success: true,\n        };\n      }\n\n      const response = await fetch(`/api/chat?roomId=${roomId}&since=${since}`);\n\n      if (!response.ok) {\n        throw new Error(`Failed to get messages: ${response.status}`);\n      }\n\n      const data = await response.json();\n      return data;\n    } catch (err) {\n      console.error('Error getting chat messages:', err);\n      throw err;\n    }\n  }, []);\n\n  // Send WebRTC offer\n  const sendOffer = useCallback(\n    async (roomId, offer) => {\n      try {\n        const response = await fetch('/api/offer', {\n          method: 'POST',\n          headers: {\n            'Content-Type': 'application/json',\n            ...(config?.authSecret && { 'x-auth-secret': config.authSecret }),\n          },\n          body: JSON.stringify({\n            roomId,\n            desc: offer,\n          }),\n        });\n\n        if (!response.ok) {\n          throw new Error(`Failed to send offer: ${response.status}`);\n        }\n\n        const data = await response.json();\n        return data;\n      } catch (err) {\n        console.error('Error sending offer:', err);\n        throw err;\n      }\n    },\n    [config]\n  );\n\n  // Get WebRTC offer\n  const getOffer = useCallback(async (roomId) => {\n    try {\n      const response = await fetch(`/api/offer?roomId=${roomId}`);\n\n      if (!response.ok) {\n        if (response.status === 404) {\n          return null; // No offer available yet\n        }\n        throw new Error(`Failed to get offer: ${response.status}`);\n      }\n\n      const data = await response.json();\n      return data;\n    } catch (err) {\n      console.error('Error getting offer:', err);\n      throw err;\n    }\n  }, []);\n\n  // Send WebRTC answer\n  const sendAnswer = useCallback(\n    async (roomId, answer) => {\n      try {\n        const response = await fetch('/api/answer', {\n          method: 'POST',\n          headers: {\n            'Content-Type': 'application/json',\n            ...(config?.authSecret && { 'x-auth-secret': config.authSecret }),\n          },\n          body: JSON.stringify({\n            roomId,\n            desc: answer,\n          }),\n        });\n\n        if (!response.ok) {\n          throw new Error(`Failed to send answer: ${response.status}`);\n        }\n\n        const data = await response.json();\n        return data;\n      } catch (err) {\n        console.error('Error sending answer:', err);\n        throw err;\n      }\n    },\n    [config]\n  );\n\n  // Get WebRTC answer\n  const getAnswer = useCallback(async (roomId) => {\n    try {\n      const response = await fetch(`/api/answer?roomId=${roomId}`);\n\n      if (!response.ok) {\n        if (response.status === 404) {\n          return null; // No answer available yet\n        }\n        throw new Error(`Failed to get answer: ${response.status}`);\n      }\n\n      const data = await response.json();\n      return data;\n    } catch (err) {\n      console.error('Error getting answer:', err);\n      throw err;\n    }\n  }, []);\n\n  // Send ICE candidate\n  const sendICECandidate = useCallback(\n    async (roomId, role, candidate) => {\n      try {\n        const response = await fetch('/api/candidate', {\n          method: 'POST',\n          headers: {\n            'Content-Type': 'application/json',\n            ...(config?.authSecret && { 'x-auth-secret': config.authSecret }),\n          },\n          body: JSON.stringify({\n            roomId,\n            role,\n            candidate,\n          }),\n        });\n\n        if (!response.ok) {\n          throw new Error(`Failed to send ICE candidate: ${response.status}`);\n        }\n\n        const data = await response.json();\n        return data;\n      } catch (err) {\n        console.error('Error sending ICE candidate:', err);\n        throw err;\n      }\n    },\n    [config]\n  );\n\n  // Get ICE candidates\n  const getICECandidates = useCallback(async (roomId, role) => {\n    try {\n      const response = await fetch(`/api/candidate?roomId=${roomId}&role=${role}`);\n\n      if (!response.ok) {\n        throw new Error(`Failed to get ICE candidates: ${response.status}`);\n      }\n\n      const data = await response.json();\n      return data;\n    } catch (err) {\n      console.error('Error getting ICE candidates:', err);\n      throw err;\n    }\n  }, []);\n\n  // Get diagnostics\n  const getDiagnostics = useCallback(async (roomId, role) => {\n    try {\n      const response = await fetch(`/api/diagnostics?roomId=${roomId}&role=${role}`);\n\n      if (!response.ok) {\n        throw new Error(`Failed to get diagnostics: ${response.status}`);\n      }\n\n      const data = await response.json();\n      return data;\n    } catch (err) {\n      console.error('Error getting diagnostics:', err);\n      throw err;\n    }\n  }, []);\n\n  return {\n    // State\n    config,\n    loading,\n    error,\n\n    // Actions\n    fetchConfig,\n    createRoom,\n    sendChatMessage,\n    getChatMessages,\n    sendOffer,\n    getOffer,\n    sendAnswer,\n    getAnswer,\n    sendICECandidate,\n    getICECandidates,\n    getDiagnostics,\n  };\n}\n","import { useState, useEffect, useRef, useCallback } from 'react';\nimport { useApi } from './useApi';\n\nexport function useChat(roomId, role, sender, secret = null) {\n  const [messages, setMessages] = useState([]);\n  const [loading, setLoading] = useState(false);\n  const [error, setError] = useState(null);\n  const [isConnected, setIsConnected] = useState(false);\n  const [lastMessageTime, setLastMessageTime] = useState(0);\n\n  const { sendChatMessage: apiSendMessage, getChatMessages: apiGetMessages } = useApi();\n  const pollingIntervalRef = useRef(null);\n  const reconnectTimeoutRef = useRef(null);\n\n  // Poll for new messages\n  const pollMessages = useCallback(async () => {\n    if (!roomId || !isConnected) return;\n\n    try {\n      const data = await apiGetMessages(roomId, lastMessageTime);\n\n      if (data.messages && data.messages.length > 0) {\n        setMessages((prevMessages) => {\n          // Filter out duplicates and merge with existing messages\n          const existingIds = new Set(prevMessages.map((msg) => msg.id));\n          const newMessages = data.messages.filter((msg) => !existingIds.has(msg.id));\n\n          if (newMessages.length > 0) {\n            // Update last message time\n            const latestTime = Math.max(...newMessages.map((msg) => msg.timestamp));\n            setLastMessageTime(latestTime);\n\n            return [...prevMessages, ...newMessages].sort((a, b) => a.timestamp - b.timestamp);\n          }\n\n          return prevMessages;\n        });\n      }\n    } catch (err) {\n      console.error('Error polling messages:', err);\n      setError('Failed to fetch messages');\n      setIsConnected(false);\n\n      // Attempt to reconnect\n      if (reconnectTimeoutRef.current) {\n        clearTimeout(reconnectTimeoutRef.current);\n      }\n\n      reconnectTimeoutRef.current = setTimeout(() => {\n        setIsConnected(true);\n        setError(null);\n      }, 5000);\n    }\n  }, [roomId, lastMessageTime, isConnected, apiGetMessages]);\n\n  // Start polling for messages\n  const startPolling = useCallback(() => {\n    if (pollingIntervalRef.current) {\n      clearInterval(pollingIntervalRef.current);\n    }\n\n    pollingIntervalRef.current = setInterval(pollMessages, 2000); // Poll every 2 seconds\n  }, [pollMessages]);\n\n  // Stop polling for messages\n  const stopPolling = useCallback(() => {\n    if (pollingIntervalRef.current) {\n      clearInterval(pollingIntervalRef.current);\n      pollingIntervalRef.current = null;\n    }\n  }, []);\n\n  // Initialize chat connection\n  useEffect(() => {\n    if (roomId && sender) {\n      setIsConnected(true);\n      setError(null);\n      setMessages([]);\n      setLastMessageTime(0);\n      startPolling();\n    } else {\n      setIsConnected(false);\n      stopPolling();\n    }\n\n    return () => {\n      stopPolling();\n      if (reconnectTimeoutRef.current) {\n        clearTimeout(reconnectTimeoutRef.current);\n      }\n    };\n  }, [roomId, sender, secret, startPolling, stopPolling]);\n\n  // Send a message\n  const sendMessage = useCallback(\n    async (message, messageSender = sender) => {\n      if (!roomId || !messageSender || !message.trim()) {\n        throw new Error('Room ID, sender, and message are required');\n      }\n\n      try {\n        setLoading(true);\n        setError(null);\n\n        const data = await apiSendMessage(roomId, message, messageSender, secret);\n\n        if (data.ok) {\n          // Add the sent message to the local state immediately\n          const newMessage = {\n            id: data.message.id,\n            sender: messageSender,\n            message: message,\n            timestamp: data.message.timestamp,\n          };\n\n          setMessages((prevMessages) => [...prevMessages, newMessage].sort((a, b) => a.timestamp - b.timestamp));\n          setLastMessageTime(data.message.timestamp);\n\n          return data.message;\n        } else {\n          throw new Error('Failed to send message');\n        }\n      } catch (err) {\n        console.error('Error sending message:', err);\n        setError(`Failed to send message: ${err.message}`);\n        throw err;\n      } finally {\n        setLoading(false);\n      }\n    },\n    [roomId, sender, apiSendMessage]\n  );\n\n  // Load initial messages\n  const loadInitialMessages = useCallback(async () => {\n    if (!roomId) return;\n\n    try {\n      setLoading(true);\n      setError(null);\n\n      const data = await apiGetMessages(roomId, 0);\n\n      if (data.messages) {\n        setMessages(data.messages.sort((a, b) => a.timestamp - b.timestamp));\n\n        if (data.messages.length > 0) {\n          const latestTime = Math.max(...data.messages.map((msg) => msg.timestamp));\n          setLastMessageTime(latestTime);\n        }\n      }\n    } catch (err) {\n      console.error('Error loading initial messages:', err);\n      setError('Failed to load messages');\n    } finally {\n      setLoading(false);\n    }\n  }, [roomId, apiGetMessages]);\n\n  // Load initial messages when room changes\n  useEffect(() => {\n    if (roomId) {\n      loadInitialMessages();\n    }\n  }, [roomId, loadInitialMessages]);\n\n  // Clear messages\n  const clearMessages = useCallback(() => {\n    setMessages([]);\n    setLastMessageTime(0);\n    setError(null);\n  }, []);\n\n  // Get message count\n  const getMessageCount = useCallback(() => {\n    return messages.length;\n  }, [messages]);\n\n  // Get messages by sender\n  const getMessagesBySender = useCallback(\n    (senderName) => {\n      return messages.filter((msg) => msg.sender === senderName);\n    },\n    [messages]\n  );\n\n  // Get latest message\n  const getLatestMessage = useCallback(() => {\n    return messages.length > 0 ? messages[messages.length - 1] : null;\n  }, [messages]);\n\n  // Check if sender has sent messages\n  const hasSenderSentMessages = useCallback(\n    (senderName) => {\n      return messages.some((msg) => msg.sender === senderName);\n    },\n    [messages]\n  );\n\n  // Get unique senders\n  const getUniqueSenders = useCallback(() => {\n    const senders = new Set(messages.map((msg) => msg.sender));\n    return Array.from(senders);\n  }, [messages]);\n\n  // Format message for display\n  const formatMessage = useCallback(\n    (message) => {\n      return {\n        ...message,\n        formattedTime: new Date(message.timestamp).toLocaleTimeString([], {\n          hour: '2-digit',\n          minute: '2-digit',\n        }),\n        formattedDate: new Date(message.timestamp).toLocaleDateString(),\n        isFromCurrentUser: message.sender === sender,\n      };\n    },\n    [sender]\n  );\n\n  // Get formatted messages\n  const getFormattedMessages = useCallback(() => {\n    return messages.map(formatMessage);\n  }, [messages, formatMessage]);\n\n  // Cleanup on unmount\n  useEffect(() => {\n    return () => {\n      stopPolling();\n      if (reconnectTimeoutRef.current) {\n        clearTimeout(reconnectTimeoutRef.current);\n      }\n    };\n  }, [stopPolling]);\n\n  return {\n    // State\n    messages,\n    loading,\n    error,\n    isConnected,\n    lastMessageTime,\n\n    // Actions\n    sendMessage,\n    clearMessages,\n    loadInitialMessages,\n\n    // Getters\n    getMessageCount,\n    getMessagesBySender,\n    getLatestMessage,\n    hasSenderSentMessages,\n    getUniqueSenders,\n    getFormattedMessages,\n  };\n}\n","import { useState, useEffect, useRef } from 'react';\nimport { useChat } from '../hooks/useChat';\n\nfunction Chat({ roomId, role, viewerId, senderSecret }) {\n  const [message, setMessage] = useState('');\n  const [sender, setSender] = useState(viewerId || role);\n  const [isTyping, setIsTyping] = useState(false);\n  const [showEmojiPicker, setShowEmojiPicker] = useState(false);\n  const messagesEndRef = useRef(null);\n  const typingTimeoutRef = useRef(null);\n\n  const { messages, sendMessage, loading, error, isConnected } = useChat(roomId, role, sender, senderSecret);\n\n  // Auto-scroll to bottom when new messages arrive\n  useEffect(() => {\n    messagesEndRef.current?.scrollIntoView({ behavior: 'smooth' });\n  }, [messages]);\n\n  // Update sender when viewerId changes\n  useEffect(() => {\n    if (viewerId) {\n      setSender(viewerId);\n    }\n  }, [viewerId]);\n\n  // Handle typing indicator\n  const handleTyping = () => {\n    setIsTyping(true);\n\n    if (typingTimeoutRef.current) {\n      clearTimeout(typingTimeoutRef.current);\n    }\n\n    typingTimeoutRef.current = setTimeout(() => {\n      setIsTyping(false);\n    }, 1000);\n  };\n\n  // Handle emoji selection\n  const handleEmojiSelect = (emoji) => {\n    setMessage((prev) => prev + emoji);\n    setShowEmojiPicker(false);\n  };\n\n  // Handle sending message\n  const handleSendMessage = async (e) => {\n    e.preventDefault();\n\n    if (!message.trim() || !sender.trim()) {\n      return;\n    }\n\n    try {\n      await sendMessage(message.trim(), sender.trim());\n      setMessage('');\n    } catch (err) {\n      console.error('Error sending message:', err);\n    }\n  };\n\n  // Handle key press\n  const handleKeyPress = (e) => {\n    if (e.key === 'Enter' && !e.shiftKey) {\n      e.preventDefault();\n      handleSendMessage(e);\n    }\n  };\n\n  // Format timestamp\n  const formatTime = (timestamp) => {\n    return new Date(timestamp).toLocaleTimeString([], {\n      hour: '2-digit',\n      minute: '2-digit',\n    });\n  };\n\n  // Get message sender display name\n  const getSenderDisplayName = (msgSender) => {\n    if (msgSender === 'host') {\n      return '🖥️ Host';\n    }\n    if (msgSender.startsWith('viewer_')) {\n      return `👀 ${msgSender}`;\n    }\n    return `👤 ${msgSender}`;\n  };\n\n  return (\n    <div className='flex flex-col h-full bg-white'>\n      {/* Chat Header */}\n      <div className='flex-shrink-0 bg-blue-600 text-white p-4'>\n        <div className='flex items-center justify-between'>\n          <h3 className='text-lg font-semibold'>💬 Chat</h3>\n          <div className='flex items-center space-x-2'>\n            <div className={`w-2 h-2 rounded-full ${isConnected ? 'bg-green-400' : 'bg-red-400'}`}></div>\n            <span className='text-sm'>{isConnected ? 'Connected' : 'Disconnected'}</span>\n          </div>\n        </div>\n        <p className='text-blue-100 text-sm mt-1'>Room: {roomId}</p>\n      </div>\n\n      {/* Messages Area */}\n      <div className='flex-1 overflow-y-auto p-4 space-y-3'>\n        {loading && messages.length === 0 && (\n          <div className='text-center text-gray-500 py-4'>\n            <div className='animate-spin rounded-full h-6 w-6 border-b-2 border-blue-600 mx-auto mb-2'></div>\n            Loading messages...\n          </div>\n        )}\n\n        {error && (\n          <div className='bg-red-50 border border-red-200 rounded-lg p-3'>\n            <div className='text-red-600 text-sm'>⚠️ {error}</div>\n          </div>\n        )}\n\n        {messages.length === 0 && !loading && (\n          <div className='text-center text-gray-500 py-8'>\n            <div className='text-4xl mb-2'>💬</div>\n            <p>No messages yet</p>\n            <p className='text-sm'>Start the conversation!</p>\n          </div>\n        )}\n\n        {messages.map((msg) => (\n          <div key={msg.id} className={`flex ${msg.sender === sender ? 'justify-end' : 'justify-start'}`}>\n            <div\n              className={`max-w-xs lg:max-w-md px-3 py-2 rounded-lg ${\n                msg.sender === sender ? 'bg-blue-600 text-white' : 'bg-gray-100 text-gray-900'\n              }`}\n            >\n              {msg.sender !== sender && (\n                <div className='text-xs font-medium text-gray-600 mb-1'>{getSenderDisplayName(msg.sender)}</div>\n              )}\n              <div className='text-sm whitespace-pre-wrap break-words'>{msg.message}</div>\n              <div className={`text-xs mt-1 ${msg.sender === sender ? 'text-blue-100' : 'text-gray-500'}`}>\n                {formatTime(msg.timestamp)}\n              </div>\n            </div>\n          </div>\n        ))}\n        <div ref={messagesEndRef} />\n      </div>\n\n      {/* Message Input */}\n      <div className='flex-shrink-0 border-t bg-gray-50 p-4'>\n        <form onSubmit={handleSendMessage} className='space-y-3'>\n          {/* Sender Name Input */}\n          <div>\n            <input\n              type='text'\n              value={sender}\n              onChange={(e) => setSender(e.target.value)}\n              placeholder='Your name'\n              className='w-full px-3 py-2 text-sm border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500'\n              maxLength={50}\n            />\n          </div>\n\n          {/* Message Input */}\n          <div className='flex space-x-2'>\n            <div className='flex-1 relative'>\n              <textarea\n                value={message}\n                onChange={(e) => {\n                  setMessage(e.target.value);\n                  handleTyping();\n                }}\n                onKeyPress={handleKeyPress}\n                placeholder='Type your message... (Enter to send, Shift+Enter for new line)'\n                className='w-full px-3 py-2 pr-10 text-sm border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 resize-none'\n                rows={2}\n                maxLength={500}\n              />\n              <button\n                type='button'\n                onClick={() => setShowEmojiPicker(!showEmojiPicker)}\n                className='absolute right-2 top-2 text-gray-400 hover:text-gray-600'\n              >\n                😊\n              </button>\n            </div>\n            <button\n              type='submit'\n              disabled={!message.trim() || !sender.trim() || loading}\n              className={`px-4 py-2 text-sm font-medium rounded-lg transition-colors ${\n                !message.trim() || !sender.trim() || loading\n                  ? 'bg-gray-300 text-gray-500 cursor-not-allowed'\n                  : 'bg-blue-600 text-white hover:bg-blue-700'\n              }`}\n            >\n              {loading ? <div className='animate-spin rounded-full h-4 w-4 border-b-2 border-white'></div> : 'Send'}\n            </button>\n          </div>\n\n          {/* Emoji Picker */}\n          {showEmojiPicker && (\n            <div className='absolute bottom-16 left-4 bg-white border border-gray-300 rounded-lg shadow-lg p-2 max-h-32 overflow-y-auto'>\n              <div className='grid grid-cols-8 gap-1'>\n                {['😀', '😂', '😍', '🤔', '👍', '👎', '❤️', '🔥', '💯', '🎉', '🚀', '⭐', '💡', '🎯', '🔥', '💪'].map(\n                  (emoji) => (\n                    <button\n                      key={emoji}\n                      type='button'\n                      onClick={() => handleEmojiSelect(emoji)}\n                      className='p-1 hover:bg-gray-100 rounded text-lg'\n                    >\n                      {emoji}\n                    </button>\n                  )\n                )}\n              </div>\n            </div>\n          )}\n\n          {/* Typing Indicator */}\n          {isTyping && <div className='text-xs text-gray-500 italic'>{sender} is typing...</div>}\n\n          {/* Character Count */}\n          <div className='flex justify-between text-xs text-gray-500'>\n            <span>{message.length}/500 characters</span>\n            <span>Press Enter to send, Shift+Enter for new line</span>\n          </div>\n        </form>\n      </div>\n\n      {/* Connection Status */}\n      {!isConnected && (\n        <div className='flex-shrink-0 bg-yellow-50 border-t border-yellow-200 p-3'>\n          <div className='flex items-center text-yellow-800'>\n            <div className='w-2 h-2 bg-yellow-400 rounded-full mr-2'></div>\n            <span className='text-sm'>Reconnecting to chat...</span>\n          </div>\n        </div>\n      )}\n    </div>\n  );\n}\n\nexport default Chat;\n"],"names":["useApi","config","setConfig","useState","loading","setLoading","error","setError","fetchConfig","useCallback","isDevelopment","response","data","err","useEffect","createRoom","headers","errorText","sendChatMessage","roomId","message","sender","secret","getChatMessages","since","sendOffer","offer","getOffer","sendAnswer","answer","getAnswer","sendICECandidate","role","candidate","getICECandidates","getDiagnostics","useChat","messages","setMessages","isConnected","setIsConnected","lastMessageTime","setLastMessageTime","apiSendMessage","apiGetMessages","pollingIntervalRef","useRef","reconnectTimeoutRef","pollMessages","prevMessages","existingIds","msg","newMessages","latestTime","a","b","startPolling","stopPolling","sendMessage","messageSender","newMessage","loadInitialMessages","clearMessages","getMessageCount","getMessagesBySender","senderName","getLatestMessage","hasSenderSentMessages","getUniqueSenders","senders","formatMessage","getFormattedMessages","Chat","viewerId","senderSecret","setMessage","setSender","isTyping","setIsTyping","showEmojiPicker","setShowEmojiPicker","messagesEndRef","typingTimeoutRef","handleTyping","handleEmojiSelect","emoji","prev","handleSendMessage","e","handleKeyPress","formatTime","timestamp","getSenderDisplayName","msgSender","jsxs","jsx"],"mappings":"8CAEO,SAASA,GAAS,CACvB,KAAM,CAACC,EAAQC,CAAS,EAAIC,EAAAA,SAAS,IAAI,EACnC,CAACC,EAASC,CAAU,EAAIF,EAAAA,SAAS,EAAI,EACrC,CAACG,EAAOC,CAAQ,EAAIJ,EAAAA,SAAS,IAAI,EAGjCK,EAAcC,EAAAA,YAAY,SAAY,CAC1C,GAAI,CACFJ,EAAW,EAAI,EACfE,EAAS,IAAI,EAGb,MAAMG,EAIJ,OAAO,SAAS,WAAa,aAC7B,OAAO,SAAS,SAAS,SAAS,WAAW,EAS/C,GAPA,QAAQ,IAAI,qBAAsB,CAChC,IAAK,GACL,KAAM,aACN,SAAU,OAAO,SAAS,SAC1B,cAAAA,CAAA,CACD,EAEGA,EAAe,CAEjB,QAAQ,IAAI,4CAA4C,EACxDR,EAAU,CACR,WAAY,0BACZ,YAAa,cACb,QAAS,OACT,SAAU,CACR,KAAM,GACN,YAAa,GACb,UAAW,EAAA,EAEb,WAAY,CACV,aAAc,GACd,aAAc,GACd,SAAU,GAAA,CACZ,CACD,EACDG,EAAW,EAAK,EAChB,MACF,CAEA,MAAMM,EAAW,MAAM,MAAM,aAAa,EAE1C,GAAI,CAACA,EAAS,GACZ,MAAM,IAAI,MAAM,2BAA2BA,EAAS,MAAM,EAAE,EAG9D,MAAMC,EAAO,MAAMD,EAAS,KAAA,EAE5B,GAAIC,EAAK,SAAWA,EAAK,OACvB,QAAQ,IAAI,kBAAmBA,EAAK,MAAM,EAC1CV,EAAUU,EAAK,MAAM,MAErB,OAAM,IAAI,MAAM,gCAAgC,CAEpD,OAASC,EAAK,CACZ,QAAQ,MAAM,wCAAyCA,CAAG,EAC1DN,EAASM,EAAI,OAAO,EACpBX,EAAU,IAAI,CAChB,QAAA,CACEG,EAAW,EAAK,CAClB,CACF,EAAG,CAAA,CAAE,EAGLS,EAAAA,UAAU,IAAM,CACdN,EAAA,CACF,EAAG,CAACA,CAAW,CAAC,EAGhB,MAAMO,EAAaN,EAAAA,YAAY,SAAY,CACzC,GAAI,CASF,GAHE,OAAO,SAAS,WAAa,aAC7B,OAAO,SAAS,SAAS,SAAS,WAAW,EAI7C,eAAQ,IAAI,sCAAsC,EAC3C,CACL,QAAS,GACT,OAAQ,iBAAmB,KAAK,OAAA,EAAS,SAAS,EAAE,EAAE,OAAO,EAAG,CAAC,EACjE,QAAS,gCAAA,EAIb,QAAQ,IAAI,6BAA8BR,CAAM,EAChD,MAAMe,EAAU,CACd,eAAgB,mBAChB,GAAIf,GAAQ,YAAc,CAAE,gBAAiBA,EAAO,UAAA,CAAW,EAEjE,QAAQ,IAAI,mBAAoBe,CAAO,EAEvC,MAAML,EAAW,MAAM,MAAM,mBAAoB,CAC/C,OAAQ,OACR,QAAAK,CAAA,CACD,EAED,GAAI,CAACL,EAAS,GAAI,CAChB,IAAIM,EAAY,GAChB,GAAI,CACFA,EAAY,MAAMN,EAAS,KAAA,CAC7B,MAAY,CACVM,EAAY,+BACd,CACA,cAAQ,MAAM,wBAAyB,CACrC,OAAQN,EAAS,OACjB,WAAYA,EAAS,WACrB,KAAMM,EACN,QAASN,EAAS,QAAU,OAAO,YAAYA,EAAS,QAAQ,QAAA,CAAS,EAAI,YAAA,CAC9E,EACK,IAAI,MACR,0BAA0BA,EAAS,MAAM,IAAIA,EAAS,UAAU,GAAGM,EAAY,MAAMA,CAAS,GAAK,EAAE,EAAA,CAEzG,CAGA,OADa,MAAMN,EAAS,KAAA,CAE9B,OAASE,EAAK,CACZ,cAAQ,MAAM,uBAAwBA,CAAG,EACnCA,CACR,CACF,EAAG,CAACZ,CAAM,CAAC,EAGLiB,EAAkBT,EAAAA,YACtB,MAAOU,EAAQC,EAASC,EAAQC,EAAS,OAAS,CAChD,GAAI,CASF,GAHE,OAAO,SAAS,WAAa,aAC7B,OAAO,SAAS,SAAS,SAAS,WAAW,EAI7C,MAAO,CACL,GAAI,GACJ,QAAS,CACP,GAAI,KAAK,IAAA,EAAM,SAAA,EACf,OAAAH,EACA,OAAAE,EACA,QAAAD,EACA,UAAW,KAAK,IAAA,CAAI,CACtB,EAIJ,MAAMT,EAAW,MAAM,MAAM,YAAa,CACxC,OAAQ,OACR,QAAS,CACP,eAAgB,mBAChB,GAAIV,GAAQ,YAAc,CAAE,gBAAiBA,EAAO,UAAA,CAAW,EAEjE,KAAM,KAAK,UAAU,CACnB,OAAAkB,EACA,QAAAC,EACA,OAAAC,EACA,GAAIC,GAAU,CAAE,OAAAA,CAAA,CAAO,CACxB,CAAA,CACF,EAED,GAAI,CAACX,EAAS,GACZ,MAAM,IAAI,MAAM,2BAA2BA,EAAS,MAAM,EAAE,EAI9D,OADa,MAAMA,EAAS,KAAA,CAE9B,OAASE,EAAK,CACZ,cAAQ,MAAM,8BAA+BA,CAAG,EAC1CA,CACR,CACF,EACA,CAACZ,CAAM,CAAA,EAIHsB,EAAkBd,EAAAA,YAAY,MAAOU,EAAQK,EAAQ,IAAM,CAC/D,GAAI,CASF,GAHE,OAAO,SAAS,WAAa,aAC7B,OAAO,SAAS,SAAS,SAAS,WAAW,EAI7C,MAAO,CACL,SAAU,CAAA,EACV,QAAS,EAAA,EAIb,MAAMb,EAAW,MAAM,MAAM,oBAAoBQ,CAAM,UAAUK,CAAK,EAAE,EAExE,GAAI,CAACb,EAAS,GACZ,MAAM,IAAI,MAAM,2BAA2BA,EAAS,MAAM,EAAE,EAI9D,OADa,MAAMA,EAAS,KAAA,CAE9B,OAASE,EAAK,CACZ,cAAQ,MAAM,+BAAgCA,CAAG,EAC3CA,CACR,CACF,EAAG,CAAA,CAAE,EAGCY,EAAYhB,EAAAA,YAChB,MAAOU,EAAQO,IAAU,CACvB,GAAI,CACF,MAAMf,EAAW,MAAM,MAAM,aAAc,CACzC,OAAQ,OACR,QAAS,CACP,eAAgB,mBAChB,GAAIV,GAAQ,YAAc,CAAE,gBAAiBA,EAAO,UAAA,CAAW,EAEjE,KAAM,KAAK,UAAU,CACnB,OAAAkB,EACA,KAAMO,CAAA,CACP,CAAA,CACF,EAED,GAAI,CAACf,EAAS,GACZ,MAAM,IAAI,MAAM,yBAAyBA,EAAS,MAAM,EAAE,EAI5D,OADa,MAAMA,EAAS,KAAA,CAE9B,OAASE,EAAK,CACZ,cAAQ,MAAM,uBAAwBA,CAAG,EACnCA,CACR,CACF,EACA,CAACZ,CAAM,CAAA,EAIH0B,EAAWlB,cAAY,MAAOU,GAAW,CAC7C,GAAI,CACF,MAAMR,EAAW,MAAM,MAAM,qBAAqBQ,CAAM,EAAE,EAE1D,GAAI,CAACR,EAAS,GAAI,CAChB,GAAIA,EAAS,SAAW,IACtB,OAAO,KAET,MAAM,IAAI,MAAM,wBAAwBA,EAAS,MAAM,EAAE,CAC3D,CAGA,OADa,MAAMA,EAAS,KAAA,CAE9B,OAASE,EAAK,CACZ,cAAQ,MAAM,uBAAwBA,CAAG,EACnCA,CACR,CACF,EAAG,CAAA,CAAE,EAGCe,EAAanB,EAAAA,YACjB,MAAOU,EAAQU,IAAW,CACxB,GAAI,CACF,MAAMlB,EAAW,MAAM,MAAM,cAAe,CAC1C,OAAQ,OACR,QAAS,CACP,eAAgB,mBAChB,GAAIV,GAAQ,YAAc,CAAE,gBAAiBA,EAAO,UAAA,CAAW,EAEjE,KAAM,KAAK,UAAU,CACnB,OAAAkB,EACA,KAAMU,CAAA,CACP,CAAA,CACF,EAED,GAAI,CAAClB,EAAS,GACZ,MAAM,IAAI,MAAM,0BAA0BA,EAAS,MAAM,EAAE,EAI7D,OADa,MAAMA,EAAS,KAAA,CAE9B,OAASE,EAAK,CACZ,cAAQ,MAAM,wBAAyBA,CAAG,EACpCA,CACR,CACF,EACA,CAACZ,CAAM,CAAA,EAIH6B,EAAYrB,cAAY,MAAOU,GAAW,CAC9C,GAAI,CACF,MAAMR,EAAW,MAAM,MAAM,sBAAsBQ,CAAM,EAAE,EAE3D,GAAI,CAACR,EAAS,GAAI,CAChB,GAAIA,EAAS,SAAW,IACtB,OAAO,KAET,MAAM,IAAI,MAAM,yBAAyBA,EAAS,MAAM,EAAE,CAC5D,CAGA,OADa,MAAMA,EAAS,KAAA,CAE9B,OAASE,EAAK,CACZ,cAAQ,MAAM,wBAAyBA,CAAG,EACpCA,CACR,CACF,EAAG,CAAA,CAAE,EAGCkB,EAAmBtB,EAAAA,YACvB,MAAOU,EAAQa,EAAMC,IAAc,CACjC,GAAI,CACF,MAAMtB,EAAW,MAAM,MAAM,iBAAkB,CAC7C,OAAQ,OACR,QAAS,CACP,eAAgB,mBAChB,GAAIV,GAAQ,YAAc,CAAE,gBAAiBA,EAAO,UAAA,CAAW,EAEjE,KAAM,KAAK,UAAU,CACnB,OAAAkB,EACA,KAAAa,EACA,UAAAC,CAAA,CACD,CAAA,CACF,EAED,GAAI,CAACtB,EAAS,GACZ,MAAM,IAAI,MAAM,iCAAiCA,EAAS,MAAM,EAAE,EAIpE,OADa,MAAMA,EAAS,KAAA,CAE9B,OAASE,EAAK,CACZ,cAAQ,MAAM,+BAAgCA,CAAG,EAC3CA,CACR,CACF,EACA,CAACZ,CAAM,CAAA,EAIHiC,EAAmBzB,EAAAA,YAAY,MAAOU,EAAQa,IAAS,CAC3D,GAAI,CACF,MAAMrB,EAAW,MAAM,MAAM,yBAAyBQ,CAAM,SAASa,CAAI,EAAE,EAE3E,GAAI,CAACrB,EAAS,GACZ,MAAM,IAAI,MAAM,iCAAiCA,EAAS,MAAM,EAAE,EAIpE,OADa,MAAMA,EAAS,KAAA,CAE9B,OAASE,EAAK,CACZ,cAAQ,MAAM,gCAAiCA,CAAG,EAC5CA,CACR,CACF,EAAG,CAAA,CAAE,EAGCsB,EAAiB1B,EAAAA,YAAY,MAAOU,EAAQa,IAAS,CACzD,GAAI,CACF,MAAMrB,EAAW,MAAM,MAAM,2BAA2BQ,CAAM,SAASa,CAAI,EAAE,EAE7E,GAAI,CAACrB,EAAS,GACZ,MAAM,IAAI,MAAM,8BAA8BA,EAAS,MAAM,EAAE,EAIjE,OADa,MAAMA,EAAS,KAAA,CAE9B,OAASE,EAAK,CACZ,cAAQ,MAAM,6BAA8BA,CAAG,EACzCA,CACR,CACF,EAAG,CAAA,CAAE,EAEL,MAAO,CAEL,OAAAZ,EACA,QAAAG,EACA,MAAAE,EAGA,YAAAE,EACA,WAAAO,EACA,gBAAAG,EACA,gBAAAK,EACA,UAAAE,EACA,SAAAE,EACA,WAAAC,EACA,UAAAE,EACA,iBAAAC,EACA,iBAAAG,EACA,eAAAC,CAAA,CAEJ,CCrZO,SAASC,EAAQjB,EAAQa,EAAMX,EAAQC,EAAS,KAAM,CAC3D,KAAM,CAACe,EAAUC,CAAW,EAAInC,EAAAA,SAAS,CAAA,CAAE,EACrC,CAACC,EAASC,CAAU,EAAIF,EAAAA,SAAS,EAAK,EACtC,CAACG,EAAOC,CAAQ,EAAIJ,EAAAA,SAAS,IAAI,EACjC,CAACoC,EAAaC,CAAc,EAAIrC,EAAAA,SAAS,EAAK,EAC9C,CAACsC,EAAiBC,CAAkB,EAAIvC,EAAAA,SAAS,CAAC,EAElD,CAAE,gBAAiBwC,EAAgB,gBAAiBC,CAAc,EAAK5C,EAAM,EAC7E6C,EAAqBC,EAAAA,OAAO,IAAI,EAChCC,EAAsBD,EAAAA,OAAO,IAAI,EAGjCE,EAAevC,EAAAA,YAAY,SAAY,CAC3C,GAAI,GAACU,GAAU,CAACoB,GAEhB,GAAI,CACF,MAAM3B,EAAO,MAAMgC,EAAezB,EAAQsB,CAAe,EAErD7B,EAAK,UAAYA,EAAK,SAAS,OAAS,GAC1C0B,EAAaW,GAAiB,CAE5B,MAAMC,EAAc,IAAI,IAAID,EAAa,IAAKE,GAAQA,EAAI,EAAE,CAAC,EACvDC,EAAcxC,EAAK,SAAS,OAAQuC,GAAQ,CAACD,EAAY,IAAIC,EAAI,EAAE,CAAC,EAE1E,GAAIC,EAAY,OAAS,EAAG,CAE1B,MAAMC,EAAa,KAAK,IAAI,GAAGD,EAAY,IAAKD,GAAQA,EAAI,SAAS,CAAC,EACtE,OAAAT,EAAmBW,CAAU,EAEtB,CAAC,GAAGJ,EAAc,GAAGG,CAAW,EAAE,KAAK,CAACE,EAAGC,IAAMD,EAAE,UAAYC,EAAE,SAAS,CACnF,CAEA,OAAON,CACT,CAAC,CAEL,OAASpC,EAAK,CACZ,QAAQ,MAAM,0BAA2BA,CAAG,EAC5CN,EAAS,0BAA0B,EACnCiC,EAAe,EAAK,EAGhBO,EAAoB,SACtB,aAAaA,EAAoB,OAAO,EAG1CA,EAAoB,QAAU,WAAW,IAAM,CAC7CP,EAAe,EAAI,EACnBjC,EAAS,IAAI,CACf,EAAG,GAAI,CACT,CACF,EAAG,CAACY,EAAQsB,EAAiBF,EAAaK,CAAc,CAAC,EAGnDY,EAAe/C,EAAAA,YAAY,IAAM,CACjCoC,EAAmB,SACrB,cAAcA,EAAmB,OAAO,EAG1CA,EAAmB,QAAU,YAAYG,EAAc,GAAI,CAC7D,EAAG,CAACA,CAAY,CAAC,EAGXS,EAAchD,EAAAA,YAAY,IAAM,CAChCoC,EAAmB,UACrB,cAAcA,EAAmB,OAAO,EACxCA,EAAmB,QAAU,KAEjC,EAAG,CAAA,CAAE,EAGL/B,EAAAA,UAAU,KACJK,GAAUE,GACZmB,EAAe,EAAI,EACnBjC,EAAS,IAAI,EACb+B,EAAY,CAAA,CAAE,EACdI,EAAmB,CAAC,EACpBc,EAAY,IAEZhB,EAAe,EAAK,EACpBiB,EAAW,GAGN,IAAM,CACXA,EAAW,EACPV,EAAoB,SACtB,aAAaA,EAAoB,OAAO,CAE5C,GACC,CAAC5B,EAAQE,EAAQC,EAAQkC,EAAcC,CAAW,CAAC,EAGtD,MAAMC,EAAcjD,EAAAA,YAClB,MAAOW,EAASuC,EAAgBtC,IAAW,CACzC,GAAI,CAACF,GAAU,CAACwC,GAAiB,CAACvC,EAAQ,KAAI,EAC5C,MAAM,IAAI,MAAM,2CAA2C,EAG7D,GAAI,CACFf,EAAW,EAAI,EACfE,EAAS,IAAI,EAEb,MAAMK,EAAO,MAAM+B,EAAexB,EAAQC,EAASuC,EAAerC,CAAM,EAExE,GAAIV,EAAK,GAAI,CAEX,MAAMgD,EAAa,CACjB,GAAIhD,EAAK,QAAQ,GACjB,OAAQ+C,EACR,QAASvC,EACT,UAAWR,EAAK,QAAQ,SACpC,EAEU,OAAA0B,EAAaW,GAAiB,CAAC,GAAGA,EAAcW,CAAU,EAAE,KAAK,CAACN,EAAGC,IAAMD,EAAE,UAAYC,EAAE,SAAS,CAAC,EACrGb,EAAmB9B,EAAK,QAAQ,SAAS,EAElCA,EAAK,OACd,KACE,OAAM,IAAI,MAAM,wBAAwB,CAE5C,OAASC,EAAK,CACZ,cAAQ,MAAM,yBAA0BA,CAAG,EAC3CN,EAAS,2BAA2BM,EAAI,OAAO,EAAE,EAC3CA,CACR,QAAC,CACCR,EAAW,EAAK,CAClB,CACF,EACA,CAACc,EAAQE,EAAQsB,CAAc,CACnC,EAGQkB,EAAsBpD,EAAAA,YAAY,SAAY,CAClD,GAAKU,EAEL,GAAI,CACFd,EAAW,EAAI,EACfE,EAAS,IAAI,EAEb,MAAMK,EAAO,MAAMgC,EAAezB,EAAQ,CAAC,EAE3C,GAAIP,EAAK,WACP0B,EAAY1B,EAAK,SAAS,KAAK,CAAC0C,EAAGC,IAAMD,EAAE,UAAYC,EAAE,SAAS,CAAC,EAE/D3C,EAAK,SAAS,OAAS,GAAG,CAC5B,MAAMyC,EAAa,KAAK,IAAI,GAAGzC,EAAK,SAAS,IAAKuC,GAAQA,EAAI,SAAS,CAAC,EACxET,EAAmBW,CAAU,CAC/B,CAEJ,OAASxC,EAAK,CACZ,QAAQ,MAAM,kCAAmCA,CAAG,EACpDN,EAAS,yBAAyB,CACpC,QAAC,CACCF,EAAW,EAAK,CAClB,CACF,EAAG,CAACc,EAAQyB,CAAc,CAAC,EAG3B9B,EAAAA,UAAU,IAAM,CACVK,GACF0C,EAAmB,CAEvB,EAAG,CAAC1C,EAAQ0C,CAAmB,CAAC,EAGhC,MAAMC,EAAgBrD,EAAAA,YAAY,IAAM,CACtC6B,EAAY,CAAA,CAAE,EACdI,EAAmB,CAAC,EACpBnC,EAAS,IAAI,CACf,EAAG,CAAA,CAAE,EAGCwD,EAAkBtD,EAAAA,YAAY,IAC3B4B,EAAS,OACf,CAACA,CAAQ,CAAC,EAGP2B,EAAsBvD,EAAAA,YACzBwD,GACQ5B,EAAS,OAAQc,GAAQA,EAAI,SAAWc,CAAU,EAE3D,CAAC5B,CAAQ,CACb,EAGQ6B,EAAmBzD,EAAAA,YAAY,IAC5B4B,EAAS,OAAS,EAAIA,EAASA,EAAS,OAAS,CAAC,EAAI,KAC5D,CAACA,CAAQ,CAAC,EAGP8B,EAAwB1D,EAAAA,YAC3BwD,GACQ5B,EAAS,KAAMc,GAAQA,EAAI,SAAWc,CAAU,EAEzD,CAAC5B,CAAQ,CACb,EAGQ+B,EAAmB3D,EAAAA,YAAY,IAAM,CACzC,MAAM4D,EAAU,IAAI,IAAIhC,EAAS,IAAKc,GAAQA,EAAI,MAAM,CAAC,EACzD,OAAO,MAAM,KAAKkB,CAAO,CAC3B,EAAG,CAAChC,CAAQ,CAAC,EAGPiC,EAAgB7D,EAAAA,YACnBW,IACQ,CACL,GAAGA,EACH,cAAe,IAAI,KAAKA,EAAQ,SAAS,EAAE,mBAAmB,GAAI,CAChE,KAAM,UACN,OAAQ,SAClB,CAAS,EACD,cAAe,IAAI,KAAKA,EAAQ,SAAS,EAAE,mBAAkB,EAC7D,kBAAmBA,EAAQ,SAAWC,CAC9C,GAEI,CAACA,CAAM,CACX,EAGQkD,EAAuB9D,EAAAA,YAAY,IAChC4B,EAAS,IAAIiC,CAAa,EAChC,CAACjC,EAAUiC,CAAa,CAAC,EAG5BxD,OAAAA,EAAAA,UAAU,IACD,IAAM,CACX2C,EAAW,EACPV,EAAoB,SACtB,aAAaA,EAAoB,OAAO,CAE5C,EACC,CAACU,CAAW,CAAC,EAET,CAEL,SAAApB,EACA,QAAAjC,EACA,MAAAE,EACA,YAAAiC,EACA,gBAAAE,EAGA,YAAAiB,EACA,cAAAI,EACA,oBAAAD,EAGA,gBAAAE,EACA,oBAAAC,EACA,iBAAAE,EACA,sBAAAC,EACA,iBAAAC,EACA,qBAAAG,CACJ,CACA,CC9PA,SAASC,EAAK,CAAE,OAAArD,EAAQ,KAAAa,EAAM,SAAAyC,EAAU,aAAAC,GAAgB,CACtD,KAAM,CAACtD,EAASuD,CAAU,EAAIxE,EAAAA,SAAS,EAAE,EACnC,CAACkB,EAAQuD,CAAS,EAAIzE,EAAAA,SAASsE,GAAYzC,CAAI,EAC/C,CAAC6C,EAAUC,CAAW,EAAI3E,EAAAA,SAAS,EAAK,EACxC,CAAC4E,EAAiBC,CAAkB,EAAI7E,EAAAA,SAAS,EAAK,EACtD8E,EAAiBnC,EAAAA,OAAO,IAAI,EAC5BoC,EAAmBpC,EAAAA,OAAO,IAAI,EAE9B,CAAE,SAAAT,EAAU,YAAAqB,EAAa,QAAAtD,EAAS,MAAAE,EAAO,YAAAiC,GAAgBH,EAAQjB,EAAQa,EAAMX,EAAQqD,CAAY,EAGzG5D,EAAAA,UAAU,IAAM,CACdmE,EAAe,SAAS,eAAe,CAAE,SAAU,SAAU,CAC/D,EAAG,CAAC5C,CAAQ,CAAC,EAGbvB,EAAAA,UAAU,IAAM,CACV2D,GACFG,EAAUH,CAAQ,CAEtB,EAAG,CAACA,CAAQ,CAAC,EAGb,MAAMU,EAAe,IAAM,CACzBL,EAAY,EAAI,EAEZI,EAAiB,SACnB,aAAaA,EAAiB,OAAO,EAGvCA,EAAiB,QAAU,WAAW,IAAM,CAC1CJ,EAAY,EAAK,CACnB,EAAG,GAAI,CACT,EAGMM,EAAqBC,GAAU,CACnCV,EAAYW,GAASA,EAAOD,CAAK,EACjCL,EAAmB,EAAK,CAC1B,EAGMO,EAAoB,MAAOC,GAAM,CAGrC,GAFAA,EAAE,eAAA,EAEE,GAACpE,EAAQ,KAAA,GAAU,CAACC,EAAO,QAI/B,GAAI,CACF,MAAMqC,EAAYtC,EAAQ,KAAA,EAAQC,EAAO,MAAM,EAC/CsD,EAAW,EAAE,CACf,OAAS9D,EAAK,CACZ,QAAQ,MAAM,yBAA0BA,CAAG,CAC7C,CACF,EAGM4E,EAAkBD,GAAM,CACxBA,EAAE,MAAQ,SAAW,CAACA,EAAE,WAC1BA,EAAE,eAAA,EACFD,EAAkBC,CAAC,EAEvB,EAGME,EAAcC,GACX,IAAI,KAAKA,CAAS,EAAE,mBAAmB,CAAA,EAAI,CAChD,KAAM,UACN,OAAQ,SAAA,CACT,EAIGC,EAAwBC,GACxBA,IAAc,OACT,WAELA,EAAU,WAAW,SAAS,EACzB,MAAMA,CAAS,GAEjB,MAAMA,CAAS,GAGxB,OACEC,EAAAA,KAAC,MAAA,CAAI,UAAU,gCAEb,SAAA,CAAAA,EAAAA,KAAC,MAAA,CAAI,UAAU,2CACb,SAAA,CAAAA,EAAAA,KAAC,MAAA,CAAI,UAAU,oCACb,SAAA,CAAAC,EAAAA,IAAC,KAAA,CAAG,UAAU,wBAAwB,SAAA,UAAO,EAC7CD,EAAAA,KAAC,MAAA,CAAI,UAAU,8BACb,SAAA,CAAAC,MAAC,OAAI,UAAW,wBAAwBxD,EAAc,eAAiB,YAAY,GAAI,QACtF,OAAA,CAAK,UAAU,UAAW,SAAAA,EAAc,YAAc,cAAA,CAAe,CAAA,CAAA,CACxE,CAAA,EACF,EACAuD,EAAAA,KAAC,IAAA,CAAE,UAAU,6BAA6B,SAAA,CAAA,SAAO3E,CAAA,CAAA,CAAO,CAAA,EAC1D,EAGA2E,EAAAA,KAAC,MAAA,CAAI,UAAU,uCACZ,SAAA,CAAA1F,GAAWiC,EAAS,SAAW,GAC9ByD,EAAAA,KAAC,MAAA,CAAI,UAAU,iCACb,SAAA,CAAAC,EAAAA,IAAC,MAAA,CAAI,UAAU,2EAAA,CAA4E,EAAM,qBAAA,EAEnG,EAGDzF,SACE,MAAA,CAAI,UAAU,iDACb,SAAAwF,EAAAA,KAAC,MAAA,CAAI,UAAU,uBAAuB,SAAA,CAAA,MAAIxF,CAAA,CAAA,CAAM,CAAA,CAClD,EAGD+B,EAAS,SAAW,GAAK,CAACjC,GACzB0F,OAAC,MAAA,CAAI,UAAU,iCACb,SAAA,CAAAC,EAAAA,IAAC,MAAA,CAAI,UAAU,gBAAgB,SAAA,KAAE,EACjCA,EAAAA,IAAC,KAAE,SAAA,iBAAA,CAAe,EAClBA,EAAAA,IAAC,IAAA,CAAE,UAAU,UAAU,SAAA,yBAAA,CAAuB,CAAA,EAChD,EAGD1D,EAAS,IAAKc,GACb4C,EAAAA,IAAC,MAAA,CAAiB,UAAW,QAAQ5C,EAAI,SAAW9B,EAAS,cAAgB,eAAe,GAC1F,SAAAyE,EAAAA,KAAC,MAAA,CACC,UAAW,6CACT3C,EAAI,SAAW9B,EAAS,yBAA2B,2BACrD,GAEC,SAAA,CAAA8B,EAAI,SAAW9B,GACd0E,EAAAA,IAAC,MAAA,CAAI,UAAU,yCAA0C,SAAAH,EAAqBzC,EAAI,MAAM,CAAA,CAAE,EAE5F4C,EAAAA,IAAC,MAAA,CAAI,UAAU,0CAA2C,WAAI,QAAQ,EACtEA,EAAAA,IAAC,MAAA,CAAI,UAAW,gBAAgB5C,EAAI,SAAW9B,EAAS,gBAAkB,eAAe,GACtF,SAAAqE,EAAWvC,EAAI,SAAS,CAAA,CAC3B,CAAA,CAAA,CAAA,GAZMA,EAAI,EAcd,CACD,EACD4C,EAAAA,IAAC,MAAA,CAAI,IAAKd,CAAA,CAAgB,CAAA,EAC5B,EAGAc,EAAAA,IAAC,OAAI,UAAU,wCACb,gBAAC,OAAA,CAAK,SAAUR,EAAmB,UAAU,YAE3C,SAAA,CAAAQ,MAAC,MAAA,CACC,SAAAA,EAAAA,IAAC,QAAA,CACC,KAAK,OACL,MAAO1E,EACP,SAAWmE,GAAMZ,EAAUY,EAAE,OAAO,KAAK,EACzC,YAAY,YACZ,UAAU,iHACV,UAAW,EAAA,CAAA,EAEf,EAGAM,EAAAA,KAAC,MAAA,CAAI,UAAU,iBACb,SAAA,CAAAA,EAAAA,KAAC,MAAA,CAAI,UAAU,kBACb,SAAA,CAAAC,EAAAA,IAAC,WAAA,CACC,MAAO3E,EACP,SAAWoE,GAAM,CACfb,EAAWa,EAAE,OAAO,KAAK,EACzBL,EAAA,CACF,EACA,WAAYM,EACZ,YAAY,iEACZ,UAAU,mIACV,KAAM,EACN,UAAW,GAAA,CAAA,EAEbM,EAAAA,IAAC,SAAA,CACC,KAAK,SACL,QAAS,IAAMf,EAAmB,CAACD,CAAe,EAClD,UAAU,2DACX,SAAA,IAAA,CAAA,CAED,EACF,EACAgB,EAAAA,IAAC,SAAA,CACC,KAAK,SACL,SAAU,CAAC3E,EAAQ,KAAA,GAAU,CAACC,EAAO,QAAUjB,EAC/C,UAAW,8DACT,CAACgB,EAAQ,KAAA,GAAU,CAACC,EAAO,KAAA,GAAUjB,EACjC,+CACA,0CACN,GAEC,SAAAA,EAAU2F,MAAC,MAAA,CAAI,UAAU,4DAA4D,EAAS,MAAA,CAAA,CACjG,EACF,EAGChB,GACCgB,EAAAA,IAAC,MAAA,CAAI,UAAU,8GACb,SAAAA,EAAAA,IAAC,MAAA,CAAI,UAAU,yBACZ,SAAA,CAAC,KAAM,KAAM,KAAM,KAAM,KAAM,KAAM,KAAM,KAAM,KAAM,KAAM,KAAM,IAAK,KAAM,KAAM,KAAM,IAAI,EAAE,IAC9FV,GACCU,EAAAA,IAAC,SAAA,CAEC,KAAK,SACL,QAAS,IAAMX,EAAkBC,CAAK,EACtC,UAAU,wCAET,SAAAA,CAAA,EALIA,CAAA,CAMP,EAGN,CAAA,CACF,EAIDR,GAAYiB,EAAAA,KAAC,MAAA,CAAI,UAAU,+BAAgC,SAAA,CAAAzE,EAAO,eAAA,EAAa,EAGhFyE,EAAAA,KAAC,MAAA,CAAI,UAAU,6CACb,SAAA,CAAAA,OAAC,OAAA,CAAM,SAAA,CAAA1E,EAAQ,OAAO,iBAAA,EAAe,EACrC2E,EAAAA,IAAC,QAAK,SAAA,+CAAA,CAA6C,CAAA,CAAA,CACrD,CAAA,CAAA,CACF,CAAA,CACF,EAGC,CAACxD,GACAwD,EAAAA,IAAC,MAAA,CAAI,UAAU,4DACb,SAAAD,EAAAA,KAAC,MAAA,CAAI,UAAU,oCACb,SAAA,CAAAC,EAAAA,IAAC,MAAA,CAAI,UAAU,yCAAA,CAA0C,EACzDA,EAAAA,IAAC,OAAA,CAAK,UAAU,UAAU,SAAA,yBAAA,CAAuB,CAAA,CAAA,CACnD,CAAA,CACF,CAAA,EAEJ,CAEJ"}