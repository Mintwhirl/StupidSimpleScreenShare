import{r,j as e}from"./main-NtkxVHS5.js";function k({roomId:n,role:c}){const[s,u]=r.useState(null),[i,p]=r.useState(!1),[o,g]=r.useState(null),[x,v]=r.useState(!0),[m,f]=r.useState(5e3),w=()=>({userAgent:navigator.userAgent,platform:navigator.platform,webrtcSupport:!!(window.RTCPeerConnection||window.webkitRTCPeerConnection||window.mozRTCPeerConnection),screenShareSupport:!!(navigator.mediaDevices&&navigator.mediaDevices.getDisplayMedia)}),l=r.useCallback(async()=>{try{p(!0),g(null);const t=await fetch(`/api/diagnostics?roomId=${n}&role=${c}`);if(!t.ok)throw new Error(`Failed to fetch diagnostics: ${t.status}`);const a=await t.json(),h=w(),d={...a,connectionStatus:a.room?.status||"unknown",role:c,roomId:n,browser:h,timestamp:Date.now()};u(d)}catch(t){console.error("Error fetching diagnostics:",t),g(t.message)}finally{p(!1)}},[n,c]);r.useEffect(()=>{if(x&&n){l();const t=setInterval(l,m);return()=>clearInterval(t)}},[x,m,n,c,l]);const y=()=>{l()},j=t=>{if(t===0)return"0 Bytes";const a=1024,h=["Bytes","KB","MB","GB"],d=Math.floor(Math.log(t)/Math.log(a));return`${parseFloat((t/a**d).toFixed(2))} ${h[d]}`},N=t=>new Date(t).toLocaleString(),b=t=>{switch(t){case"connected":return"text-green-600";case"connecting":return"text-yellow-600";case"disconnected":return"text-red-600";default:return"text-gray-600"}};return e.jsxs("div",{className:"flex flex-col h-full bg-white",children:[e.jsxs("div",{className:"flex-shrink-0 bg-green-600 text-white p-4",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("h3",{className:"text-lg font-semibold",children:"ðŸ”§ Diagnostics"}),e.jsx("div",{className:"flex items-center space-x-2",children:e.jsx("button",{onClick:y,disabled:i,className:"px-3 py-1 text-sm bg-green-700 rounded hover:bg-green-800 disabled:opacity-50",children:i?"Loading...":"Refresh"})})]}),e.jsxs("p",{className:"text-green-100 text-sm mt-1",children:["Room: ",n," | Role: ",c]})]}),e.jsx("div",{className:"flex-shrink-0 bg-gray-50 border-b p-3",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("label",{className:"flex items-center space-x-2",children:[e.jsx("input",{type:"checkbox",checked:x,onChange:t=>v(t.target.checked),className:"rounded"}),e.jsx("span",{className:"text-sm text-gray-700",children:"Auto-refresh"})]}),e.jsxs("select",{value:m,onChange:t=>f(Number(t.target.value)),className:"text-sm border border-gray-300 rounded px-2 py-1",children:[e.jsx("option",{value:1e3,children:"1s"}),e.jsx("option",{value:5e3,children:"5s"}),e.jsx("option",{value:1e4,children:"10s"}),e.jsx("option",{value:3e4,children:"30s"})]})]})}),e.jsxs("div",{className:"flex-1 overflow-y-auto p-4",children:[i&&!s&&e.jsxs("div",{className:"text-center text-gray-500 py-8",children:[e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-green-600 mx-auto mb-2"}),"Loading diagnostics..."]}),o&&e.jsx("div",{className:"bg-red-50 border border-red-200 rounded-lg p-3 mb-4",children:e.jsxs("div",{className:"text-red-600 text-sm",children:["âš ï¸ ",o]})}),s&&e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"bg-white border border-gray-200 rounded-lg p-4",children:[e.jsx("h4",{className:"font-semibold text-gray-900 mb-3",children:"Connection Status"}),e.jsxs("div",{className:"grid grid-cols-2 gap-4 text-sm",children:[e.jsxs("div",{children:[e.jsx("span",{className:"text-gray-600",children:"Status:"}),e.jsx("span",{className:`ml-2 font-medium ${b(s.connectionStatus)}`,children:s.connectionStatus})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-gray-600",children:"Role:"}),e.jsx("span",{className:"ml-2 font-medium",children:s.role})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-gray-600",children:"Room ID:"}),e.jsx("span",{className:"ml-2 font-mono text-xs",children:s.roomId})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-gray-600",children:"Last Updated:"}),e.jsx("span",{className:"ml-2 text-xs",children:N(s.timestamp)})]})]})]}),s.webrtc&&e.jsxs("div",{className:"bg-white border border-gray-200 rounded-lg p-4",children:[e.jsx("h4",{className:"font-semibold text-gray-900 mb-3",children:"WebRTC Statistics"}),e.jsxs("div",{className:"space-y-2 text-sm",children:[e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("span",{className:"text-gray-600",children:"ICE Connection State:"}),e.jsx("span",{className:`ml-2 font-medium ${b(s.webrtc.iceConnectionState)}`,children:s.webrtc.iceConnectionState})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-gray-600",children:"Signaling State:"}),e.jsx("span",{className:"ml-2 font-medium",children:s.webrtc.signalingState})]})]}),s.webrtc.stats&&e.jsxs("div",{className:"mt-3",children:[e.jsx("h5",{className:"font-medium text-gray-800 mb-2",children:"Connection Stats"}),e.jsxs("div",{className:"grid grid-cols-2 gap-4 text-xs",children:[e.jsxs("div",{children:[e.jsx("span",{className:"text-gray-600",children:"Bytes Sent:"}),e.jsx("span",{className:"ml-2 font-mono",children:j(s.webrtc.stats.bytesSent||0)})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-gray-600",children:"Bytes Received:"}),e.jsx("span",{className:"ml-2 font-mono",children:j(s.webrtc.stats.bytesReceived||0)})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-gray-600",children:"Packets Sent:"}),e.jsx("span",{className:"ml-2 font-mono",children:s.webrtc.stats.packetsSent||0})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-gray-600",children:"Packets Received:"}),e.jsx("span",{className:"ml-2 font-mono",children:s.webrtc.stats.packetsReceived||0})]})]})]})]})]}),e.jsxs("div",{className:"bg-white border border-gray-200 rounded-lg p-4",children:[e.jsx("h4",{className:"font-semibold text-gray-900 mb-3",children:"Browser Information"}),e.jsxs("div",{className:"grid grid-cols-2 gap-4 text-sm",children:[e.jsxs("div",{children:[e.jsx("span",{className:"text-gray-600",children:"User Agent:"}),e.jsx("span",{className:"ml-2 text-xs font-mono",children:s.browser?.userAgent})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-gray-600",children:"Platform:"}),e.jsx("span",{className:"ml-2",children:s.browser?.platform})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-gray-600",children:"WebRTC Support:"}),e.jsx("span",{className:`ml-2 font-medium ${s.browser?.webrtcSupport?"text-green-600":"text-red-600"}`,children:s.browser?.webrtcSupport?"Yes":"No"})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-gray-600",children:"Screen Share Support:"}),e.jsx("span",{className:`ml-2 font-medium ${s.browser?.screenShareSupport?"text-green-600":"text-red-600"}`,children:s.browser?.screenShareSupport?"Yes":"No"})]})]})]}),s.network&&e.jsxs("div",{className:"bg-white border border-gray-200 rounded-lg p-4",children:[e.jsx("h4",{className:"font-semibold text-gray-900 mb-3",children:"Network Information"}),e.jsxs("div",{className:"space-y-2 text-sm",children:[e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("span",{className:"text-gray-600",children:"Connection Type:"}),e.jsx("span",{className:"ml-2",children:s.network.connectionType||"Unknown"})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-gray-600",children:"Effective Type:"}),e.jsx("span",{className:"ml-2",children:s.network.effectiveType||"Unknown"})]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("span",{className:"text-gray-600",children:"Downlink:"}),e.jsxs("span",{className:"ml-2",children:[s.network.downlink||"Unknown"," Mbps"]})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-gray-600",children:"RTT:"}),e.jsxs("span",{className:"ml-2",children:[s.network.rtt||"Unknown"," ms"]})]})]})]})]}),s.errors&&s.errors.length>0&&e.jsxs("div",{className:"bg-red-50 border border-red-200 rounded-lg p-4",children:[e.jsx("h4",{className:"font-semibold text-red-900 mb-3",children:"Recent Errors"}),e.jsx("div",{className:"space-y-2",children:s.errors.map((t,a)=>e.jsxs("div",{className:"text-sm text-red-800",children:[e.jsx("div",{className:"font-medium",children:t.message}),e.jsx("div",{className:"text-xs text-red-600 mt-1",children:N(t.timestamp)})]},a))})]})]}),!s&&!i&&!o&&e.jsxs("div",{className:"text-center text-gray-500 py-8",children:[e.jsx("div",{className:"text-4xl mb-2",children:"ðŸ”§"}),e.jsx("p",{children:"No diagnostics data available"}),e.jsx("p",{className:"text-sm",children:"Click refresh to load diagnostics"})]})]})]})}export{k as default};
//# sourceMappingURL=Diagnostics-DLbbTXq-.js.map
