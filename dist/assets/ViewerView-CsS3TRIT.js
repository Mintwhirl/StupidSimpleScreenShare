import{u as P,r as n,j as e}from"./main-BcE9vIwY.js";import{u as Q,C as r,E as W,U as c,V as $,A,S as u}from"./useWebRTC-XiiYbhRr.js";const M=s=>{if(!s||typeof s!="string")return{valid:!1,error:"Viewer ID is required"};const o=s.trim();return o.length===0?{valid:!1,error:"Viewer ID cannot be empty"}:o.length<3?{valid:!1,error:"Viewer ID must be at least 3 characters long"}:o.length>50?{valid:!1,error:"Viewer ID must be 50 characters or less"}:/^[a-zA-Z0-9\s\-_]+$/.test(o)?{valid:!0}:{valid:!1,error:"Viewer ID can only contain letters, numbers, spaces, hyphens, and underscores"}},q=(s,o)=>{switch(o.type){case"CONNECT_REQUESTED":return{...s,status:"connecting",error:null,reconnectAttempts:0};case"CONNECT_SUCCESS":return{...s,status:"connected",error:null,reconnectAttempts:0};case"CONNECT_FAILED":return{...s,status:"failed",error:o.error,reconnectAttempts:s.reconnectAttempts+1};case"DISCONNECT_REQUESTED":return{...s,status:"disconnecting",error:null};case"DISCONNECT_SUCCESS":return{...s,status:"disconnected",error:null,reconnectAttempts:0};case"RECONNECT_REQUESTED":return{...s,status:"reconnecting",error:null};case"RESET":return{status:"idle",error:null,reconnectAttempts:0};default:return s}};function B({config:s,onGoHome:o}){const{roomId:d,viewerId:i,updateViewerId:v,updateSenderSecret:S}=P(),[O,x]=n.useState(null),[f,b]=n.useState(null),[N,l]=n.useReducer(q,{status:"idle",error:null,reconnectAttempts:0}),g=n.useRef(null),h=n.useRef(null);n.useEffect(()=>()=>{h.current&&clearTimeout(h.current)},[]);const w=n.useCallback(t=>{const a=M(t);return b(a.valid?null:a.error),a.valid},[]),{connectToHost:I,disconnect:D,connectionState:m,remoteStream:C,error:j}=Q(d,"viewer",s,i),R=m,E=m===r.CONNECTED,p=m===r.CONNECTING,V=m;n.useEffect(()=>{C&&g.current&&(g.current.srcObject=C)},[C]),n.useEffect(()=>{(async()=>{if(console.log("ViewerView: Attempting to register viewer sender for room:",d,"viewerId:",i),!d||!i){console.log("ViewerView: No roomId or viewerId, skipping registration");return}try{console.log("ViewerView: Making registration request to:",A.REGISTER_SENDER);const a=await fetch(A.REGISTER_SENDER,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({roomId:d,senderId:i})});if(console.log("ViewerView: Registration response status:",a.status),a.ok){const L=await a.json();console.log("ViewerView: Registration successful, secret received"),S(L.secret)}else console.warn("ViewerView: Failed to register viewer sender:",a.status)}catch(a){console.warn("ViewerView: Failed to register viewer sender:",a)}})()},[d,i,S]),n.useEffect(()=>{j?x(j):m===r.CONNECTED&&x(null)},[j,m]);const y=n.useCallback(async()=>{if(x(null),b(null),!(i&&!w(i)))try{x(null),l({type:"CONNECT_REQUESTED"}),await I(),l({type:"CONNECT_SUCCESS"})}catch(t){console.error("[ViewerView] Error connecting to host:",t),x(t.message||W.CONNECTION_FAILED),l({type:"CONNECT_FAILED",error:t.message})}},[d,I,i,w]),T=n.useCallback(async()=>{if(!(N.status==="disconnecting"||N.status==="disconnected")){l({type:"DISCONNECT_REQUESTED"});try{await D(),g.current&&(g.current.srcObject=null),l({type:"DISCONNECT_SUCCESS"})}catch(t){console.error("Error disconnecting:",t),l({type:"CONNECT_FAILED",error:"Failed to disconnect properly"})}}},[D,N.status]),_=n.useCallback(async()=>{if(!(N.status==="reconnecting"||N.status==="connecting")){h.current&&(clearTimeout(h.current),h.current=null),l({type:"RECONNECT_REQUESTED"});try{await T(),h.current=setTimeout(async()=>{try{await y()}catch(t){console.error("Reconnection failed:",t),l({type:"CONNECT_FAILED",error:"Reconnection failed"})}},1e3)}catch(t){console.error("Error during reconnection process:",t),l({type:"CONNECT_FAILED",error:"Reconnection process failed"})}}},[N.status,T,y]),U=()=>{const t=`viewer_${crypto.randomUUID().substring(0,8)}`;return v(t),t},k=()=>{switch(R){case r.CONNECTED:return u.SUCCESS;case r.CONNECTING:return u.WARNING;case r.DISCONNECTED:return u.ERROR;default:return u.DEFAULT}},G=()=>{switch(R){case r.CONNECTED:return c.CONNECTED;case r.CONNECTING:return c.CONNECTING;case r.DISCONNECTED:return c.DISCONNECTED;default:return c.UNKNOWN}},F=()=>{switch(V){case r.CONNECTED:return u.SUCCESS;case r.CONNECTING:return u.WARNING;case r.DISCONNECTED:return u.ERROR;default:return u.DEFAULT}},H=()=>{switch(V){case r.CONNECTED:return c.HOST_ONLINE;case r.CONNECTING:return c.CONNECTING_TO_HOST;case r.DISCONNECTED:return c.HOST_OFFLINE;default:return c.UNKNOWN}};return e.jsxs("div",{className:"space-y-6",children:[e.jsx("div",{className:"bg-white rounded-lg shadow-md p-6",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-2xl font-bold text-gray-900 mb-2",children:"üëÄ Viewing Room"}),e.jsxs("p",{className:"text-gray-900",children:["Room ID: ",e.jsx("span",{className:"font-mono font-semibold bg-gray-100 px-2 py-1 rounded",children:d})]})]}),e.jsxs("div",{className:"text-right",children:[e.jsxs("div",{className:`text-sm font-semibold ${k()}`,children:["Connection: ",G()]}),e.jsx("div",{className:`text-sm font-semibold ${F()}`,children:H()})]})]})}),e.jsxs("div",{className:"bg-white rounded-lg shadow-md p-6",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-4",children:"Your Viewer ID"}),e.jsxs("div",{className:"flex items-center space-x-4",children:[e.jsxs("div",{className:"flex-1",children:[e.jsx("input",{type:"text",value:i||"",onChange:t=>{v(t.target.value),t.target.value.trim()?w(t.target.value):b(null)},placeholder:"Enter your name or leave blank for auto-generated ID",className:`w-full px-3 py-2 border rounded-lg focus:outline-none focus:ring-2 ${f?"border-red-500 focus:ring-red-500":"border-gray-300 focus:ring-blue-500"}`}),f&&e.jsx("p",{className:"text-red-500 text-sm mt-1",children:f})]}),e.jsx("button",{onClick:U,className:"px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors",children:"Generate ID"})]}),e.jsx("p",{className:"text-sm text-gray-500 mt-2",children:"This ID helps identify you in the chat and diagnostics."})]}),e.jsxs("div",{className:"bg-white rounded-lg shadow-md p-6",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-4",children:"Connection Controls"}),e.jsx("div",{className:"flex items-center justify-center space-x-4",children:E?e.jsxs("div",{className:"flex items-center space-x-4",children:[e.jsx("button",{onClick:_,className:"px-6 py-3 bg-yellow-600 text-white rounded-lg hover:bg-yellow-700 transition-colors",children:c.RECONNECT}),e.jsx("button",{onClick:T,className:"px-6 py-3 bg-red-600 text-white rounded-lg hover:bg-red-700 transition-colors",children:c.DISCONNECT})]}):e.jsx("button",{onClick:y,disabled:p,className:`px-6 py-3 rounded-lg font-medium transition-colors ${p?"bg-gray-400 text-white cursor-not-allowed":"bg-green-600 text-white hover:bg-green-700"}`,children:p?c.CONNECTING:c.CONNECT_TO_HOST})}),E&&e.jsx("div",{className:"mt-4 text-center",children:e.jsxs("div",{className:"flex items-center justify-center space-x-2 text-green-600",children:[e.jsx("div",{className:"w-2 h-2 bg-green-600 rounded-full animate-pulse"}),e.jsx("span",{className:"text-sm font-medium",children:"Connected to Host"})]})})]}),O&&e.jsxs("div",{className:"bg-red-50 border-2 border-red-400 rounded-lg p-5 shadow-lg",children:[e.jsxs("div",{className:"flex items-start",children:[e.jsx("div",{className:"text-red-600 text-2xl mr-3",children:"‚ö†Ô∏è"}),e.jsxs("div",{className:"flex-1",children:[e.jsx("h4",{className:"text-red-800 font-bold text-lg mb-2",children:"Connection Error"}),e.jsx("p",{className:"text-red-900 text-base leading-relaxed",children:O}),e.jsxs("div",{className:"mt-4 space-y-2",children:[e.jsx("p",{className:"text-red-700 text-sm font-medium",children:"Common fixes:"}),e.jsxs("ul",{className:"text-red-700 text-sm list-disc list-inside space-y-1",children:[e.jsx("li",{children:"Make sure the host has started sharing"}),e.jsx("li",{children:"Check the room ID is correct"}),e.jsx("li",{children:"Try refreshing the page"})]})]})]})]}),e.jsx("div",{className:"mt-4 flex justify-center",children:e.jsx("button",{onClick:_,className:"text-base bg-red-600 text-white px-6 py-3 rounded-lg hover:bg-red-700 transition-colors font-medium shadow-md",children:"üîÑ Try Connecting Again"})})]}),E&&e.jsxs("div",{className:"bg-white rounded-lg shadow-md p-6",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-4",children:"Host's Screen"}),e.jsxs("div",{className:"relative",children:[e.jsx($,{ref:g,className:"w-full max-w-4xl mx-auto rounded-lg border border-gray-200 bg-black",autoPlay:!0,playsInline:!0}),!C&&e.jsx("div",{className:"absolute inset-0 flex items-center justify-center bg-gray-100 rounded-lg",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600 mx-auto mb-4"}),e.jsx("p",{className:"text-gray-600",children:"Waiting for host to start sharing..."})]})}),C&&e.jsx("div",{className:"absolute top-2 right-2 bg-black bg-opacity-50 text-white px-2 py-1 rounded text-xs",children:"Live"})]})]}),!E&&!p&&e.jsx("div",{className:"bg-white rounded-lg shadow-md p-6",children:e.jsxs("div",{className:"text-center py-12",children:[e.jsx("div",{className:"text-6xl mb-4",children:"üì∫"}),e.jsx("h3",{className:"text-xl font-semibold text-gray-900 mb-2",children:"Ready to View"}),e.jsx("p",{className:"text-gray-600 mb-6",children:'Use the "Connect to Host" button above to start viewing the shared screen.'})]})}),e.jsxs("div",{className:"bg-blue-50 border border-blue-200 rounded-lg p-6",children:[e.jsx("h3",{className:"text-lg font-semibold text-blue-900 mb-4",children:"üìã Instructions"}),e.jsxs("div",{className:"space-y-2 text-sm text-blue-800",children:[e.jsx("p",{children:"‚Ä¢ Make sure the host has started sharing their screen"}),e.jsx("p",{children:'‚Ä¢ Click "Connect to Host" to join the viewing session'}),e.jsx("p",{children:"‚Ä¢ Use the Chat feature to communicate with the host"}),e.jsx("p",{children:"‚Ä¢ The screen will appear automatically when the host starts sharing"}),e.jsx("p",{children:`‚Ä¢ Click "Disconnect" when you're done viewing`})]})]}),e.jsx("div",{className:"flex justify-center space-x-4",children:e.jsx("button",{onClick:o,className:"px-6 py-2 bg-gray-600 text-white rounded-lg hover:bg-gray-700 transition-colors",children:"Back to Home"})})]})}export{B as default};
//# sourceMappingURL=ViewerView-CsS3TRIT.js.map
