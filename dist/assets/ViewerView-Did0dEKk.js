import{u as L,r as a,j as e}from"./main-CiC9Utmw.js";import{u as P,C as t,A as V,E as k,U as r,V as W,S as o}from"./useWebRTC-CL3U19iS.js";const M=m=>{if(!m||typeof m!="string")return{valid:!1,error:"Viewer ID is required"};const l=m.trim();return l.length===0?{valid:!1,error:"Viewer ID cannot be empty"}:l.length<3?{valid:!1,error:"Viewer ID must be at least 3 characters long"}:l.length>50?{valid:!1,error:"Viewer ID must be 50 characters or less"}:/^[a-zA-Z0-9\s\-_]+$/.test(l)?{valid:!0}:{valid:!1,error:"Viewer ID can only contain letters, numbers, spaces, hyphens, and underscores"}};function z({config:m,onGoHome:l}){const{roomId:c,viewerId:i,updateViewerId:p,updateSenderSecret:v}=L(),[w,d]=a.useState(null),[C,f]=a.useState(null),x=a.useRef(null),j=a.useCallback(s=>{const n=M(s);return f(n.valid?null:n.error),n.valid},[]),{connectToHost:y,disconnect:_,connectionState:u,remoteStream:h,error:E}=P(c,"viewer",m,i),T=u,g=u===t.CONNECTED,b=u===t.CONNECTING,I=u;a.useEffect(()=>{h&&x.current&&(x.current.srcObject=h)},[h]),a.useEffect(()=>{E?d(E):u===t.CONNECTED&&d(null)},[E,u]);const O=a.useCallback(async s=>{try{const n=await fetch(`${V.DIAGNOSTICS}?roomId=${s}`);return n.ok?(await n.json()).room?.exists===!0:!1}catch(n){return console.error("Error validating room:",n),!1}},[]),S=a.useCallback(async()=>{if(d(null),setRoomIdError(null),f(null),!!j(i))try{if(d(null),!await O(c)){d(k.ROOM_NOT_FOUND);return}if(await y(),i&&i.trim())try{const N=await fetch(V.REGISTER_SENDER,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({roomId:c,senderId:i.trim()})});if(N.ok){const F=await N.json();v(F.secret)}}catch(N){console.warn("Failed to register sender ID:",N)}}catch(n){console.error("Error connecting to host:",n),d(k.CONNECTION_FAILED)}},[c,y,O,i,j,v]),D=async()=>{try{await _(),x.current&&(x.current.srcObject=null)}catch(s){console.error("Error disconnecting:",s)}},R=()=>{D().then(()=>{setTimeout(S,1e3)})},G=()=>{const s=`viewer_${crypto.randomUUID().substring(0,8)}`;return p(s),s},U=()=>{switch(T){case t.CONNECTED:return o.SUCCESS;case t.CONNECTING:return o.WARNING;case t.DISCONNECTED:return o.ERROR;default:return o.DEFAULT}},A=()=>{switch(T){case t.CONNECTED:return r.CONNECTED;case t.CONNECTING:return r.CONNECTING;case t.DISCONNECTED:return r.DISCONNECTED;default:return r.UNKNOWN}},H=()=>{switch(I){case t.CONNECTED:return o.SUCCESS;case t.CONNECTING:return o.WARNING;case t.DISCONNECTED:return o.ERROR;default:return o.DEFAULT}},$=()=>{switch(I){case t.CONNECTED:return r.HOST_ONLINE;case t.CONNECTING:return r.CONNECTING_TO_HOST;case t.DISCONNECTED:return r.HOST_OFFLINE;default:return r.UNKNOWN}};return e.jsxs("div",{className:"space-y-6",children:[e.jsx("div",{className:"bg-white rounded-lg shadow-md p-6",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-2xl font-bold text-gray-900 mb-2",children:"üëÄ Viewing Room"}),e.jsxs("p",{className:"text-gray-600",children:["Connected to room: ",e.jsx("span",{className:"font-mono font-medium",children:c})]})]}),e.jsxs("div",{className:"text-right",children:[e.jsxs("div",{className:`text-sm font-medium ${U()}`,children:["Connection: ",A()]}),e.jsx("div",{className:`text-sm font-medium ${H()}`,children:$()})]})]})}),e.jsxs("div",{className:"bg-white rounded-lg shadow-md p-6",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-4",children:"Your Viewer ID"}),e.jsxs("div",{className:"flex items-center space-x-4",children:[e.jsxs("div",{className:"flex-1",children:[e.jsx("input",{type:"text",value:i||"",onChange:s=>{p(s.target.value),s.target.value.trim()?j(s.target.value):f(null)},placeholder:"Enter your name or leave blank for auto-generated ID",className:`w-full px-3 py-2 border rounded-lg focus:outline-none focus:ring-2 ${C?"border-red-500 focus:ring-red-500":"border-gray-300 focus:ring-blue-500"}`}),C&&e.jsx("p",{className:"text-red-500 text-sm mt-1",children:C})]}),e.jsx("button",{onClick:G,className:"px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors",children:"Generate ID"})]}),e.jsx("p",{className:"text-sm text-gray-500 mt-2",children:"This ID helps identify you in the chat and diagnostics."})]}),e.jsxs("div",{className:"bg-white rounded-lg shadow-md p-6",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-4",children:"Connection Controls"}),e.jsx("div",{className:"flex items-center justify-center space-x-4",children:g?e.jsxs("div",{className:"flex items-center space-x-4",children:[e.jsx("button",{onClick:R,className:"px-6 py-3 bg-yellow-600 text-white rounded-lg hover:bg-yellow-700 transition-colors",children:r.RECONNECT}),e.jsx("button",{onClick:D,className:"px-6 py-3 bg-red-600 text-white rounded-lg hover:bg-red-700 transition-colors",children:r.DISCONNECT})]}):e.jsx("button",{onClick:S,disabled:b,className:`px-6 py-3 rounded-lg font-medium transition-colors ${b?"bg-gray-400 text-white cursor-not-allowed":"bg-green-600 text-white hover:bg-green-700"}`,children:b?r.CONNECTING:r.CONNECT_TO_HOST})}),g&&e.jsx("div",{className:"mt-4 text-center",children:e.jsxs("div",{className:"flex items-center justify-center space-x-2 text-green-600",children:[e.jsx("div",{className:"w-2 h-2 bg-green-600 rounded-full animate-pulse"}),e.jsx("span",{className:"text-sm font-medium",children:"Connected to Host"})]})})]}),w&&e.jsxs("div",{className:"bg-red-50 border border-red-200 rounded-lg p-4",children:[e.jsxs("div",{className:"flex items-center",children:[e.jsx("div",{className:"text-red-600 mr-2",children:"‚ö†Ô∏è"}),e.jsxs("div",{children:[e.jsx("h4",{className:"text-red-800 font-medium",children:"Connection Error"}),e.jsx("p",{className:"text-red-700 text-sm mt-1",children:w})]})]}),e.jsx("div",{className:"mt-3",children:e.jsx("button",{onClick:R,className:"text-sm bg-red-600 text-white px-3 py-1 rounded hover:bg-red-700 transition-colors",children:"Try Again"})})]}),g&&e.jsxs("div",{className:"bg-white rounded-lg shadow-md p-6",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-4",children:"Host's Screen"}),e.jsxs("div",{className:"relative",children:[e.jsx(W,{ref:x,className:"w-full max-w-4xl mx-auto rounded-lg border border-gray-200 bg-black",autoPlay:!0,playsInline:!0}),!h&&e.jsx("div",{className:"absolute inset-0 flex items-center justify-center bg-gray-100 rounded-lg",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600 mx-auto mb-4"}),e.jsx("p",{className:"text-gray-600",children:"Waiting for host to start sharing..."})]})}),h&&e.jsx("div",{className:"absolute top-2 right-2 bg-black bg-opacity-50 text-white px-2 py-1 rounded text-xs",children:"Live"})]})]}),!g&&!b&&e.jsx("div",{className:"bg-white rounded-lg shadow-md p-6",children:e.jsxs("div",{className:"text-center py-12",children:[e.jsx("div",{className:"text-6xl mb-4",children:"üì∫"}),e.jsx("h3",{className:"text-xl font-semibold text-gray-900 mb-2",children:"Ready to View"}),e.jsx("p",{className:"text-gray-600 mb-6",children:'Use the "Connect to Host" button above to start viewing the shared screen.'})]})}),e.jsxs("div",{className:"bg-blue-50 border border-blue-200 rounded-lg p-6",children:[e.jsx("h3",{className:"text-lg font-semibold text-blue-900 mb-4",children:"üìã Instructions"}),e.jsxs("div",{className:"space-y-2 text-sm text-blue-800",children:[e.jsx("p",{children:"‚Ä¢ Make sure the host has started sharing their screen"}),e.jsx("p",{children:'‚Ä¢ Click "Connect to Host" to join the viewing session'}),e.jsx("p",{children:"‚Ä¢ Use the Chat feature to communicate with the host"}),e.jsx("p",{children:"‚Ä¢ The screen will appear automatically when the host starts sharing"}),e.jsx("p",{children:`‚Ä¢ Click "Disconnect" when you're done viewing`})]})]}),e.jsx("div",{className:"flex justify-center space-x-4",children:e.jsx("button",{onClick:l,className:"px-6 py-2 bg-gray-600 text-white rounded-lg hover:bg-gray-700 transition-colors",children:"Back to Home"})})]})}export{z as default};
//# sourceMappingURL=ViewerView-Did0dEKk.js.map
